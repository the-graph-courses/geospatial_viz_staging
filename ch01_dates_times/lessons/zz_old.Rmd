---
title: '\ '
output:
  html_document:
    number_sections: true
    toc: true
    css: !expr here::here("global/style/style.css")
    highlight: kate
  word_document:
    toc: true
editor_options:
  markdown:
    wrap: 100
  canonical: true
  chunk_output_type: inline
---

```{r, echo = F, message = F, warning = F}
# Load packages ----
if(!require(pacman)) install.packages("pacman")
pacman::p_load(clock,
               knitr,
               tidyverse, 
               here,
               outbreaks)

# Source functions 
source(here("global/functions/misc_functions.R"))

## autograders
suppressMessages(source(here::here("ch01_dates_times/lessons/00_dates_times_autograder.R")))

ebola_data <- outbreaks::ebola_sierraleone_2014
```

------------------------------------------------------------------------

<!-- Title: Working with dates and times in R -->
# Learning objectives 

1. Separate a date column into different columns - Weekdays column, months column and year column)
2. Build a date column from individual date components.

In our previous lesson **Plotting Temporal data**, we created the plot below to visualize the trend of Ebola cases

```{r cases_per_week_plot, echo=FALSE}
ebola_data%>%
  dplyr::mutate(date_of_onset = clock::date_group(date_of_onset, "day", n=7))%>%
  group_by(date_of_onset)%>%
  count(date_of_onset)%>%
  ggplot(aes(x=date_of_onset, y=n))+geom_line()+
  scale_x_date(date_breaks = "1 month", date_labels = "%B %Y", guide = guide_axis(angle = 45))+
  labs(title="Ebola cases counts over time (May 2014- October 2015)")
  #facet_zoom(xlim = c("November 2014, December 2014"))
  #gghighlight::gghighlight(n>500, label_key = n)

```

However, what if we wanted to investigate if there is a difference between case numbers recorded over the weekend and cases record during the week?

Let's walk through this example together.
In this case, we define Week as Monday to Friday and Weekend as Saturday and Sunday.

Once again, we are using the ebola_sierraleone_2014 data set.
Run the code chunk below to get started.

```{r}
#Create an R object named ebola_data 
ebola_data <- outbreaks::ebola_sierraleone_2014
head(ebola_data) #show the first 6 rows of the ebola_data
```

We breakdown the `ebola_data$date_of_onset` date column.
That is, segregate out the different components of the date column into a day column, month column and year column.

### Day column

```{r date_weekday_factor}
#Extract weekday into new ordered column called Wkday_onset
ebola_data<-ebola_data%>%
                     mutate(Wkday_onset=clock::date_weekday_factor
                                (ebola_data$date_of_onset,
                     abbreviate = FALSE),#Weekday names will be spelled out in full
                     .after= "date_of_onset") #new column should be placed after date_of_onset column
                     
```

If you want only the "numeric" day of a date, for example to separate the day `11` from the date `2014-11-20`, you would use the `get_day()` function from the `{clock}`package. 

See below for an in depth example. The following code extracts the day from a column of the dates and creates a new column of days in numeric form.

```{r day_numeric}
ebola_data<-ebola_data%>%
                     mutate(day_sample =clock::get_day(ebola_data$date_of_sample),
                            .after= "date_of_sample")
```


### Month column

```{r date_month_factor}
#Extract month into new ordered column called Month_onset
ebola_data<-ebola_data%>%
                     mutate(Month_onset =clock::date_month_factor                     
                                (ebola_data$date_of_onset,
                     abbreviate = FALSE), #Month names will be spelled out in full
                     .after= "Wkday_onset") #new column should be placed after Wkday_onset column
                     
```

The `date_day_factor` and `date_month_factor` functions from the clock package create new columns from an existing date column and turn it into an ordered factor of day or month columns.
Run the code below to check the class of the columns.

```{r class}
class(ebola_data$Wkday_onset)
class(ebola_data$Month_onset)

```

If you want only the "numeric" form of the month that is 11 instead of November from the date `2014-11-20`, you would use the `get_month()` function from the `{clock}`package. 

The code below extracts the month from the `date_of_sample` column and creates a new column of months in numeric form.

```{r }
ebola_data<-ebola_data%>%
                     mutate(Month_sample =clock::get_month(ebola_data$date_of_sample),
                            .after= "date_of_sample")
```

We use the function `clock::get_year()` to extract the year component from the date column (date_of_onset).
Then we convert into a factor using `ebola_data$Year_onset <- factor(ebola_data$Year_onset)`

### Year column

```{r year_factor}
#Step 1- Extract year from date_of_onset into new column called Year_onset
ebola_data<-ebola_data%>%
                     mutate(Year_onset =clock::get_year(ebola_data$date_of_onset),
                            .after= "Month_onset")#new column should be placed after Month_onset column

#Step 1- Extract year from date_of_sample into new column called Year_sample
ebola_data<-ebola_data%>%
                     mutate(Year_sample =clock::get_year(ebola_data$date_of_sample),
                            .after= "Month_sample")#new column should be placed after Month_onset column


#Step 2- Convert Year_onset into factors
ebola_data$Year_onset <- factor(ebola_data$Year_onset)

#Confirm class of ebola_data$Year_onset
class(ebola_data$Year_onset)
                     
```

### Take note-

Or you can use the code shown below to complete Steps 1 and 2 in one instance.

``` r
ebola_data<-ebola_data%>% 
                mutate(Year_onset =clock::get_year(ebola_data$date_of_onset),
                       .after= "Month_onset",
                       across(Year_onset,as_factor)) #convert to Year_onset column to factor
```

Are you ready to check out the result of the all the codes we have run above?

#### Mini Quiz 1

How many columns do you think we should have by now in the ebola_data dataframe?
10, 8, 11 11 is the correct answer.

## The `date_build` function
Now we have split up the date_of_sample column into into components. The day_sample column has the days, the month column is in the Month_sample and the year column is the Year_sample.

We can use the `date_build()` function also from the `{clock}` package to rebuild the date_of sample column from its components. Check the following example.

```{r date_build}
ebola_data <- ebola_data%>%
                        mutate(check_date_onset=
                                 date_build(Year_sample,Month_sample,day_sample),
                               .after="date_of_sample")
```


<!-- Run the code below to get a new RStudio tab to explore the ebola_data with the new weekday, month and year columns. -->

<!-- ```{r view_ebola_data} -->
<!-- view(ebola_data) -->
<!-- ``` -->



<!-- Fill in the blank code as a quiz type?? -->

<!-- #### Mini quiz 2,3, 4 -->

<!-- ```{r color_code_Wkday} -->

<!-- ``` -->
