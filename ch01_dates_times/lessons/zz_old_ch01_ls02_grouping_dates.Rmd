---
title: '\ '
output:
  html_document:
    number_sections: true
    toc: true
    css: !expr here::here("global/style/style.css")
    highlight: kate
  word_document:
    toc: true
editor_options:
  markdown:
    wrap: 100
  canonical: true
  chunk_output_type: inline
---

```{r, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Source functions 
source(here("global/functions/misc_functions.R"))

# knitr settings
knitr::opts_chunk$set(warning = F, message = F, class.source = "tgc-code-block", error = T)

```

# Learning objective

1\.
You can group temporal data into different categories (days, months and years)


# Introduction

When working with data is important for data analysts to understand that data aggregation can hide a lot of things.


For example, when you rely on monthly case counts to tell you the entire story about the development of new disease cases, there is a lot granular data you are not taking advantage of.


Disaggregating monthly data into weekly case counts and even daily counts might reveal more information about the progression of diseases, or trend of sales of a product.


For instance, if the monthly total is 50 by disaggregating this data and plotting a graph of the weekly trend, you might realise that the last two weeks contributes 90% of the weekly total.


With these insights on the weekly trend of incidence cases, you as a data scientist can advise health professionals to intensify public health prevention training and interventions during the two last weeks of every month.

```{r packages}
#install.packages("clock")
#install.packages("outbreaks")

#Proceed to load the packages if you have already installed them.
library(clock)
library(outbreaks)
library(tidyverse)

#Create an R object named ebola_data 
ebola_data <- outbreaks::ebola_sierraleone_2014
head(ebola_data)

#I am having a small quiz to get dimensions
```

With `head(ebola_data)` function, you can explore the initial rows of the data set.

### Mini Quiz

Run `dim(ebola_data)`,in the R console to get the dimensions of the ebola_data.

The `names(ebola_data)` function would show the names of the different columns.

```{r columns}
names(ebola_data)
```

It seems intuitive that the columns `ebola_data$date_of_onset` and `ebola_data$date_of_sample` are columns containing date information.
Let us confirm that by checking the class of the columns.

```{r date columns}
class(ebola_data$date_of_onset)
class(ebola_data$date_of_sample)
```

We are going to discuss some functions in the clock package.

`clock::date_group()` groups the data by an aspect of the date (month of the year, or day of the month).
For example we can use the `clock::date_group()` function to get a count of total Ebola cases in every month.

## Monthly cases

First, let us get the number of total Ebola cases per month.

**Assumptions**

To answer this question, we assume that each individual date_of_onset entry represents a unique case of Ebola.

Thus, to get the total unique cases per month, we would use the dplyr function mutate (`dplyr::mutate`) and the `clock::date_group()` to modify the date of onset column, to separate the data by months.
That is what this section of code does.`dplyr::mutate(date_of_onset = date_group(date_of_onset, "month")`

Then, the following section of code `group_by(date_of_onset)%>% count(date_of_onset)` counts the number of unique instances of date_of_onset grouped by months.

Here is the code all together.

##Take note- z For data wrangling, we are using mutate, group_by, count and filter functions from the dpylr package (part of the tidyverse packages) for data wrangling

```{r total_ebola_cases per month}
total_ebola_cases_month<- ebola_data%>%
                    dplyr::mutate(date_of_onset = date_group(date_of_onset, "month"))%>%
                    group_by(date_of_onset)%>%
                    count(date_of_onset)
total_ebola_cases_month




b=ebola_data%>%
              dplyr::mutate(month_onset = date_group(date_of_onset, "month"))%>%
              group_by(month_onset)%>%
              count(month_onset)

c=ebola_data%>%
              dplyr::mutate(Month_onset = date_month_factor(date_of_onset,
                                                            abbreviate = FALSE))%>%
              group_by(Month_onset)%>%
              count(Month_onset)
```

This additional code plots the total Ebola cases per month and shows that the November 2014 is month with the highest total Ebola cases is 2,157 cases in November 2014.

##Take note- `guides( x = guide_axis(angle = 45)` is a ggplot function that can be used to change the direction of the axis labels on a graph.
In the code above we use it to create diagonal axis labels by indicating `angle= 45`.

```{r month_plot}
total_ebola_cases_month%>%
  ggplot(aes(x=date_of_onset,y=n,fill= date_of_onset))+geom_col()+
  scale_x_date(date_breaks= "2 month",date_labels = "%B %Y")+
  guides(x = guide_axis(angle = 45))+ 
  labs(title= "A Bar chart showing the counts of Ebola cases per month")+ylab("Monthly Case count")+xlab("Month in which cases occurred")




```

## Total Number of Ebola cases per week

To breakdown the total Ebola cases by week, let's take a close look at the components of the function `clock::date_group()`.

`clock::date_group(x, precision, n)` requires the following arguments.
1.
a column containing dates 2.
a measure for precision which can be by `day`, by `month` or by `year`.
3.
A single positive integer specifying a multiple of precision to use.

Let's break down how `clock::date_group()` used in the example below to find the number of cases per week `clock::date_group(date_of_onset, "day", n=7)`

1.  `ebola_data$date_of_onset` is the column containing dates we are working with.
2.  `day` is the measure for precision
3.  `n=7` specifies that the grouping should be done every 7 days (1 week)

```{r cases_per_week}
cases_per_week<-ebola_data%>%
  dplyr::mutate(date_of_onset = clock::date_group(date_of_onset, "day", n=7))%>%
  group_by(date_of_onset)%>%
  count(date_of_onset)%>%
  arrange(desc(n)) #arranges the data in descending order from the date with the highest ebola case count.

cases_per_week
```

### Mini Quiz 2

how to group by every 2 weeks?
ans n=14 (2 weeks = 14 days)

\### Mini Quiz 3 Group date_of_sample by 2 months

We can plot `cases_per_week` to get an idea of the trend of cases occurring per week

```{r cases_per_week_plot}
cases_per_week%>%
  ggplot(aes(x=date_of_onset, y=n, fill= date_of_onset))+geom_col()+geom_line()+
  scale_x_date(date_breaks = "1 month", date_labels = "%B %Y", guide = guide_axis(angle = 45))+
  labs(title="Ebola cases counts over time (May 2014- October 2015)")
  #facet_zoom(xlim = c("November 2014, December 2014"))
  #gghighlight::gghighlight(n>500, label_key = n)

try_week<- ebola_data%>%
              dplyr::mutate(week_of_onset = clock::date_group(date_of_onset, "day", n=7))%>%
              group_by(week_of_onset)%>%
              count(week_of_onset)
  
  
try_week%>%
    mutate(month_of_onset= date_month_factor(week_of_onset, abbreviate= FALSE),
           year_onset=get_year(week_of_onset))%>%
    filter(month_of_onset %in% c("September","October","November")&
             year_onset==2014)%>%
    ggplot(aes(x=week_of_onset, y= n, fill= month_of_onset))+geom_col()+geom_line()+
  scale_x_date(date_breaks = "1 week", date_labels = "%d %b %Y", guide = guide_axis(angle = 45))+scale_y_continuous(n.breaks = 20)+
  labs(title="Ebola cases counts over time (September, October and November 2014)")+ylab("Case_count")
    

try_day<- ebola_data%>%
              dplyr::mutate(day_of_onset = clock::date_group(date_of_onset, "day", n=1))%>%
              group_by(day_of_onset)%>%
              count(day_of_onset)
  
  
try_day%>%
    mutate(month_of_onset= date_month_factor(day_of_onset, abbreviate= FALSE),
           wkday_onset=date_weekday_factor(day_of_onset, abbreviate= FALSE))%>%
    filter(month_of_onset == "November")%>%
    ggplot(aes(x=day_of_onset, y= n, fill= wkday_onset))+geom_col()+
  scale_x_date(date_breaks = "1 day", date_labels = "%d %b %Y", guide = guide_axis(angle = 45))+scale_y_continuous(n.breaks = 20)+
  labs(title="Ebola cases counts over time (November 2014)")+ylab("Daily Case_count")

try_day%>%
    mutate(month_of_onset= date_month_factor(day_of_onset, abbreviate= FALSE),
           wkday_onset=date_group(day_of_onset, "day", n=7))%>%
    filter(month_of_onset == "November")%>%
    ggplot(aes(x=day_of_onset, y= n, fill= wkday_onset))+geom_col()+geom_line()+
  scale_x_date(date_breaks = "1 day", date_labels = "%d %b %Y", guide = guide_axis(angle = 45))+scale_y_continuous(n.breaks = 20)+
  labs(title="Ebola cases counts over time (November 2014)")+ylab("Daily Case_count")
```
